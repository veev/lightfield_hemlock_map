<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Draw GeoJSON points</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.3.1/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.3.1/mapbox-gl.css' rel='stylesheet' />
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
        #slider { position: absolute; left: 10px; }
        #year { position: absolute; top: 20px; left: 10px; color: white; }
    </style>
</head>
<body>

<div id='map'></div>
<label id='year'></label>
<input id='slider' type='range' min='0' max='3' step='1' value='0' />
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoidmVldiIsImEiOiIzdzVEVDdrIn0.z3N2X1Fk7rx4wXesVf0-rQ';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/veev/ck1e3aa002vop1ck2pmc8tj0v',
    center: [-74, 42],
    zoom: 7
});

const years = ['1993', '2003', '2004', '2005', '2006', '2007', '2008', '2009', '2010', '2011', '2012', '2013', '2014', '2015', '2016', '2017', '2018'];
const evalGrps = ['361993', '362008', '362013', '362018']

function filterBy(yearIndex) {
 
    const filters = ['==', 'EVAL_GRP', evalGrps[yearIndex]];
    map.setFilter('treePlotLayer', filters);
    map.setFilter('deadTreePlotLayer', filters);
    
    // Set the label to the month
    document.getElementById('year').textContent = evalGrps[yearIndex];
 }

map.on('load', function () {

    // load data with d3 (just my preference, load it another way if you prefer)
    d3.json('Hudson_Counties_Trees_Years_Alt.geojson').then(data => {
      console.log(data)

      map.addSource('treePlots', {
          'type': 'geojson',
          'data': data
      });

    //   map.addLayer({
    //       'id': 'yearPlotLayer',
    //       'type': 'circle',
    //       'source': 'treePlots',
    //       'paint': {
    //           'circle-radius': [
    //                 'interpolate', ['linear'], ['zoom'],
    //                 10, ['/', ['number', ['get', 'LIVE_TREES']], 10],
    //                 13, ['/', ['number', ['get', 'LIVE_TREES']], 3],
    //             ],
    //             // 'circle-color': 'white',
    //             // 'circle-opacity': 0.4
    //           'circle-color': [
    //                 'match',
    //                 ['get', 'EVAL_GRP'],
    //                 '361993', 'blue',
    //                 '362008', 'mediumvioletred',//'pink',
    //                 '362013', 'gold',//'hotpink',
    //                 '362018', 'limegreen',//'mediumvioletred'
    //                 'white'
    //           ],
    //           'circle-opacity': [
    //                 'match',
    //                 ['get', 'EVAL_GRP'],
    //                 '361993', 0.5,
    //                 '362008', 0.5,
    //                 '362013', 0.5,
    //                 '362018', 0.5,
    //                 0.5
    //           ]
    //       }
    //   });

      map.on('click', 'yearPlotLayer', function (e) {
        new mapboxgl.Popup()
        .setLngLat(e.lngLat)
        .setHTML(e.features.map(function(feature) { 
            return feature.properties.CN + '<br>' + feature.properties.YEAR + '<br>' + feature.properties.EVAL_GRP + '<br>' + feature.properties.LIVE_HEM_TREES; 
            }).join('<p>'))
        .addTo(map);
    });
        
        // Change the cursor to a pointer when the mouse is over the states layer.
      map.on('mouseenter', 'yearPlotLayer', function () {
        map.getCanvas().style.cursor = 'pointer';
    });
        
        // Change it back to a pointer when it leaves.
      map.on('mouseleave', 'yearPlotLayer', function () {
        map.getCanvas().style.cursor = '';
    });

      map.addLayer({
          'id': 'treePlotLayer',
          'type': 'circle',
          'source': 'treePlots',
          'paint': {
              'circle-radius': [
                    'interpolate', ['linear'], ['zoom'],
                    10, ['/', ['number', ['get', 'LIVE_TREES']], 10],
                    13, ['/', ['number', ['get', 'LIVE_TREES']], 3],
                ],
              'circle-color': [
                    'interpolate', ['linear'],
                    ['get', 'LIVE_HEM_TREES'],
                    0, '#fff',
                    50, '#00ff00'
              ]
          }
    });

    map.addLayer({
          'id': 'deadTreePlotLayer',
          'type': 'circle',
          'source': 'treePlots',
          'paint': {
              'circle-radius': [
                    'interpolate', ['linear'], ['zoom'],
                    10, ['/', ['number', ['get', 'LIVE_TREES']], 10],
                    13, ['/', ['number', ['get', 'LIVE_TREES']], 3],
                ],
              'circle-color': [
                    'interpolate', ['linear'],
                    ['get', 'DEAD_HEM_TREES'],
                    0, '#fff',
                    10, '#ff0000'
              ],
              'circle-opacity': [
                    'interpolate', ['linear'],
                    ['get', 'DEAD_HEM_TREES'],
                    0, 0.1,
                    10, 0.8
              ]
          }
        });

        filterBy(0);
        
        document.getElementById('slider').addEventListener('input', function(e) {
            var yearIndex = parseInt(e.target.value, 10);
            filterBy(yearIndex);
        });

    });
});
</script>

</body>
</html>